{% extends "forum/base.html" %}

{% load markup %}

{% block css %} 
    {{ block.super }} 
    <link rel="stylesheet" type="text/css" href="/static/css/addform.css" />
{% endblock %}

{% block title %}{{ block.super}} : {{ thread.title }}{% endblock %}

{% block path %}
    {{ block.super }} &raquo; 
        <a href="{{ thread.category.get_absolute_url }}">{{ thread.category }}</a> 
        &raquo; {{ thread.title }} 
        {% if thread.solved %} &bull; <strong>Solved</strong> {% endif %}

    {% if user.is_authenticated %}
    <div style="text-align: right">
        {% ifequal user thread.author %} 
            {% if thread.solved %} 
                <a href="solved/">Usuń flagę "rozwiązany"</a> 
            {% else %}
                <a href="solved/">Oznacz jako rozwiązany</a> 
            {% endif %}
        {% endifequal %}
        {% ifnotequal user thread.latest_post.author %}&bull; <a href="reply/">Napisz odpowiedź</a> {% endifnotequal %}
    </div>

    {% endif %}

{% endblock %}


{% block forumdata %}
    {% for p in post %}
        <div class="post">
            <div class="panel">
                <div class="panel-right">
                    <small>{{ p.date }}</small>
                    {% ifequal p.author.username user.username %}
                        {% ifequal p thread.latest_post %}
                            &bull; <a href="{{ p.id }}/edit/">edytuj</a> 
                            &bull; <a href="{{ thread.get_absolute_url }}{{ p.id }}/delete/">usuń</a> 
                        {% endifequal %}
                    {% endifequal %}
                    &bull; <a href="#">cytuj</a>
                </div>
                <div>
                    <a href="#{{ forloop.counter|add:page.offset }}" id="{{ forloop.counter|add:page.offset }}">
                        #{{ forloop.counter|add:page.offset }} 
                    </a> 
                    &bull; autor : <strong><a href="{{ p.author.get_absolute_url }}">{{ p.author }}</a></strong>
                </div>
            </div>
            <div class="text rightnav">
                {{ p.text|markdown }}
            </div>
            <div style="clear:both"><!-- sentry --></div>
        </div>
    {% endfor %}

    {# quick post form #}
    {% if user.is_authenticated %}
        {% ifnotequal thread.latest_post.author user %}
            <div class="wmd-preview"></div>    
            <div id="response">
                <form action="reply/" method="POST">
                    {{ form.text.errors }}
                    {{ form.text }}
                    <div id="id_submit"><input type="submit" value="Wyślij" /></div>
                </form>
                <div style="text-align:right; margin: 1em 3em;">Do formatowania tekstu możesz użyć składni <a href="http://en.wikipedia.org/wiki/Markdown">mardkown</a></div>
                <script type="text/javascript" src="/static/javascript/wmd.js"></script>
            </div>
        {% endifnotequal %}
    {% endif %}
    
    <div class="center">
        {% for n in page.sitecount %}
            {% ifequal n page.offset_step %}
                <strong>{{ n }}</strong>
            {% else %}
                <a href="{{ thread.get_absolute_url }}offset/{{n}}/">{{ n }}</a>
            {% endifequal %}
            {% if not forloop.last %}&bull;{% endif %}
        {% endfor %}
    </div>


{% endblock %}
